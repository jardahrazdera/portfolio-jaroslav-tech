{% extends 'core/base.html' %}
{% load static %}

{% block title %}{{ post.title }} - {{ block.super }}{% endblock %}

{% block meta_description %}{% if post.excerpt %}{{ post.excerpt|striptags }}{% else %}{{ post.content|striptags|truncatewords:50 }}{% endif %}{% endblock %}

{% block extra_head %}
{% if debug %}
<link rel="stylesheet" href="{% static 'blog/css/blog.css' %}">
{% else %}
<link rel="stylesheet" href="{% static 'dist/blog.min.css' %}">
{% endif %}
{% endblock %}

{% block structured_data %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "{{ post.title }}",
  "author": {
    "@type": "Person",
    "name": "{{ post.author.get_full_name|default:post.author.username }}"
  },
  "publisher": {
    "@type": "Person",
    "name": "Jaroslav Hrazdera"
  },
  "datePublished": "{{ post.created_at|date:'c' }}",
  "dateModified": "{{ post.updated_at|date:'c' }}",
  "description": "{% if post.excerpt %}{{ post.excerpt|striptags }}{% else %}{{ post.content|striptags|truncatewords:50 }}{% endif %}",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ request.build_absolute_uri }}"
  }
}
</script>
{% endblock %}

{% block before_main %}
{% include 'blog/components/breadcrumb.html' with post=post %}
{% endblock %}

{% block content %}
<section class="content-section">
    <div class="container">
        <article class="post-detail">
            <header class="post-header">
                <h2>{{ post.title }}</h2>

                {% include 'blog/components/post_meta.html' with post=post show_updated=True compact=False %}

                {% if post.categories.exists or post.tags.exists %}
                    <div class="post-taxonomy">
                        {% if post.categories.exists %}
                            <div class="post-categories">
                                {% for category in post.categories.all %}
                                    <span class="blog-category">{{ category.name }}</span>
                                {% endfor %}
                            </div>
                        {% endif %}

                        {% if post.tags.exists %}
                            <div class="post-tags">
                                {% for tag in post.tags.all %}
                                    <span class="blog-tag" style="border-color: {{ tag.color }}">{{ tag.name }}</span>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                {% endif %}
            </header>

            <div class="blog-content">
                {{ post.content|linebreaks }}
            </div>
        </article>

        <nav class="blog-navigation">
            <div class="hero-buttons">
                <a href="{% url 'blog:post_list' %}" class="btn btn-primary">&larr; Back to Blog</a>
            </div>
        </nav>
    </div>
</section>
{% endblock %}