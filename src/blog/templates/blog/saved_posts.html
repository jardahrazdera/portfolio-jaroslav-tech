{% extends 'core/base.html' %}
{% load static %}
{% load i18n %}
{% load seo_tags %}

{% block title %}{% page_title page_title="Saved Posts" %}{% endblock %}

{% block extra_head %}
{% if debug %}
<link rel="stylesheet" href="{% static 'blog/css/blog.css' %}">
<script src="{% static 'blog/js/bookmarks.js' %}"></script>
<script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
{% else %}
<link rel="stylesheet" href="{% static 'dist/blog.min.css' %}">
<script src="{% static 'blog/js/bookmarks.js' %}"></script>
<script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
{% endif %}
{% endblock %}

{% block extra_meta %}
{% seo_meta_tags %}
{% endblock %}

{% block structured_data %}
{% structured_data_json_ld %}
{% breadcrumb_json_ld %}
{{ block.super }}
{% endblock %}

{% block before_main %}
{% include 'blog/components/breadcrumb.html' %}
{% endblock %}

{% block content %}
<section class="content-section">
    <div class="container" x-data="bookmarkManager()">
        <header class="page-header">
            <h2>
                <i class="fas fa-bookmark" aria-hidden="true"></i>
                Saved Posts
                <span x-show="getBookmarkCount() > 0" x-text="`(${getBookmarkCount()})`" class="bookmark-count"></span>
            </h2>
            <p class="page-description">
                Your bookmarked posts for later reading. Bookmarks are saved locally in your browser.
            </p>

            <div class="saved-posts-actions" x-show="getBookmarkCount() > 0">
                <button @click="exportBookmarks()" class="btn btn-secondary btn-small">
                    <i class="fas fa-download" aria-hidden="true"></i>
                    Export Bookmarks
                </button>
                <button @click="clearAllBookmarks()" class="btn btn-danger btn-small">
                    <i class="fas fa-trash-alt" aria-hidden="true"></i>
                    Clear All
                </button>
            </div>
        </header>

        <div class="saved-posts-content">
            <!-- Empty state -->
            <div x-show="getBookmarkCount() === 0" class="empty-state">
                <div class="empty-state-icon">
                    <i class="far fa-bookmark" aria-hidden="true"></i>
                </div>
                <h3>No saved posts yet</h3>
                <p>
                    Start bookmarking posts by clicking the
                    <i class="far fa-bookmark" aria-hidden="true"></i>
                    bookmark button on any blog post.
                </p>
                <div class="empty-state-actions">
                    <a href="{% url 'blog:post_list' %}" class="btn btn-primary">
                        Browse Blog Posts
                    </a>
                </div>
            </div>

            <!-- Saved posts grid -->
            <div x-show="getBookmarkCount() > 0" class="saved-posts-grid">
                <template x-for="post in getBookmarkedPosts()" :key="post.id">
                    <article class="saved-post-card" :id="`saved-post-${post.id}`">
                        <div class="saved-post-header">
                            <h3>
                                <a :href="post.url" x-text="post.title"></a>
                            </h3>
                            <button
                                @click="removeBookmark(post.id)"
                                class="remove-bookmark-button"
                                :aria-label="`Remove ${post.title} from bookmarks`"
                                title="Remove bookmark">
                                <i class="fas fa-times" aria-hidden="true"></i>
                            </button>
                        </div>

                        <div class="saved-post-meta">
                            <span class="bookmark-date" x-text="formatBookmarkDate(post.bookmarkedAt)"></span>
                            <span class="meta-separator">â€¢</span>
                            <span class="post-author" x-text="post.author"></span>
                        </div>

                        <div x-show="post.excerpt" class="saved-post-excerpt">
                            <p x-text="post.excerpt"></p>
                        </div>

                        <div x-show="post.categories && post.categories.length > 0" class="saved-post-categories">
                            <template x-for="category in post.categories" :key="category">
                                <span class="category-tag" x-text="category"></span>
                            </template>
                        </div>

                        <div x-show="post.tags && post.tags.length > 0" class="saved-post-tags">
                            <template x-for="tag in post.tags" :key="tag">
                                <span class="tag" x-text="tag"></span>
                            </template>
                        </div>

                        <div class="saved-post-actions">
                            <a :href="post.url" class="btn btn-primary btn-small">
                                Read Post
                            </a>
                            <button
                                @click="removeBookmark(post.id)"
                                class="btn btn-secondary btn-small">
                                <i class="fas fa-bookmark" aria-hidden="true"></i>
                                Remove
                            </button>
                        </div>
                    </article>
                </template>
            </div>

            <!-- Quick stats -->
            <div x-show="getBookmarkCount() > 0" class="saved-posts-stats">
                <div class="stats-item">
                    <strong x-text="getBookmarkCount()"></strong>
                    <span x-text="getBookmarkCount() === 1 ? 'post saved' : 'posts saved'"></span>
                </div>
                <div class="stats-note">
                    <i class="fas fa-info-circle" aria-hidden="true"></i>
                    Bookmarks are stored locally in your browser and will persist across sessions.
                </div>
            </div>
        </div>

        <nav class="page-navigation">
            <div class="hero-buttons">
                <a href="{% url 'blog:post_list' %}" class="btn btn-primary">
                    &larr; Back to Blog
                </a>
            </div>
        </nav>
    </div>
</section>
{% endblock %}