{% extends 'devtracker/base_tracker.html' %}
{% load i18n %}

{% block title %}{% trans "Dashboard" %} - DevTracker{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>{% trans "Dashboard" %}</h1>
        <p>{% trans "Project management overview" %}</p>
    </div>

    <!-- Statistics Cards -->
    <div class="dashboard-grid">
        <div class="dashboard-card">
            <h3>{% trans "Project Statistics" %}</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number">{{ total_projects }}</div>
                    <div class="stat-label">{% trans "Total Projects" %}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ active_projects }}</div>
                    <div class="stat-label">{% trans "Active" %}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ completed_projects }}</div>
                    <div class="stat-label">{% trans "Completed" %}</div>
                </div>
            </div>
        </div>

        <div class="dashboard-card">
            <h3>{% trans "Task Statistics" %}</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number">{{ total_tasks }}</div>
                    <div class="stat-label">{% trans "Total Tasks" %}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ completed_tasks }}</div>
                    <div class="stat-label">{% trans "Completed" %}</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ total_tasks|add:"-"|add:completed_tasks }}</div>
                    <div class="stat-label">{% trans "Remaining" %}</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="dashboard-grid">
        <div class="dashboard-card">
            <h3>{% trans "Recent Tasks" %}</h3>
            {% if recent_tasks %}
                <div class="recent-list">
                    {% for task in recent_tasks %}
                        <div class="recent-item">
                            <div class="recent-title">
                                <a href="{% url 'devtracker:project_detail' slug=task.project.slug %}">{{ task.title }}</a>
                            </div>
                            <div class="recent-project">{{ task.project.name }}</div>
                            <div class="recent-meta">
                                <span class="priority priority-{{ task.priority }}">
                                    {% if task.priority == 1 %}{% trans "Low" %}
                                    {% elif task.priority == 2 %}{% trans "Medium" %}
                                    {% else %}{% trans "High" %}
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>{% trans "No recent tasks found." %}</p>
            {% endif %}
        </div>

        <div class="dashboard-card">
            <h3>{% trans "Recent Time Logs" %}</h3>
            {% if recent_logs %}
                <div class="recent-list">
                    {% for log in recent_logs %}
                        <div class="recent-item">
                            <div class="recent-title">{{ log.description }}</div>
                            <div class="recent-project">
                                <a href="{% url 'devtracker:project_detail' slug=log.project.slug %}">{{ log.project.name }}</a>
                            </div>
                            <div class="recent-meta">
                                <span class="time-hours">{{ log.hours }}h</span>
                                <span class="time-date">{{ log.date }}</span>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>{% trans "No time logs found." %}</p>
            {% endif %}
        </div>
    </div>

    <!-- Projects Overview -->
    <div class="dashboard-card">
        <h3>{% trans "All Projects" %}</h3>
        <div class="projects-overview">
            {% if projects %}
                <div class="project-grid">
                    {% for project in projects %}
                        <div class="project-card">
                            <h4><a href="{% url 'devtracker:project_detail' slug=project.slug %}">{{ project.name }}</a></h4>
                            <p>{{ project.description|truncatewords:15 }}</p>
                            
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: {{ project.get_progress_percentage }}%"></div>
                            </div>
                            <small>{{ project.get_progress_percentage }}% {% trans "completed" %}</small>

                            <div class="project-meta">
                                <span class="project-status status-{{ project.status }}">{{ project.get_status_display }}</span>
                                <span class="hours">{{ project.get_total_hours }}h</span>
                            </div>
                            
                            <div class="project-actions">
                                <a href="{% url 'devtracker:project_edit' slug=project.slug %}" class="btn btn-secondary">{% trans "Edit" %}</a>
                                <a href="{% url 'devtracker:time_log' slug=project.slug %}" class="btn btn-secondary">{% trans "Log Time" %}</a>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>{% trans "No projects found." %} <a href="{% url 'devtracker:project_create' %}">{% trans "Create your first project" %}</a></p>
            {% endif %}
        </div>
        
        {% if is_paginated %}
            <div class="pagination">
                <span class="page-links">
                    {% if page_obj.has_previous %}
                        <a href="?page=1">&laquo; {% trans "first" %}</a>
                        <a href="?page={{ page_obj.previous_page_number }}">{% trans "previous" %}</a>
                    {% endif %}

                    <span class="current">
                        {% trans "Page" %} {{ page_obj.number }} {% trans "of" %} {{ page_obj.paginator.num_pages }}
                    </span>

                    {% if page_obj.has_next %}
                        <a href="?page={{ page_obj.next_page_number }}">{% trans "next" %}</a>
                        <a href="?page={{ page_obj.paginator.num_pages }}">{% trans "last" %} &raquo;</a>
                    {% endif %}
                </span>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}